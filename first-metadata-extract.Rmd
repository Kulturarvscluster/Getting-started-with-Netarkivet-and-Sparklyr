---
title: "Learn to use ETL-Netarkivet"
author: Per MÃ¸ldrup-Dalum
date: 13 September 2017
output: html_document
---

## Introduction

This small tutorial shows how to use ETL Netarkivet to extract metadata information from WARC and ARC files from the Danish web archive. To follow along, you need access to test data that resembles data from that web archive.

In this tutorial we will use a small corpus called Fodboldkorpus that is stored as a Git repository at the Royal Danish Library. Unfortunately, this data is protected and not for the general public.

## Get the data

Standing in the root of this Getting Started project, execute this command

```
$ git clone https://pmd@sbprojects.statsbiblioteket.dk/stash/scm/pnw/fodboldkorpus.git fodbold
```

This gives you a new directory `fodbold` with 16 metadata WARC files generated by harvested Danish football clubs by NetarchiveSuite[^1].

```
  -rw-r--r--   1 pmd  staff       653 13 Sep 10:46 README.md
  drwxr-xr-x  20 pmd  staff       640 13 Sep 10:46 .
  -rw-r--r--   1 pmd  staff  33496149 13 Sep 10:46 9-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff   8971257 13 Sep 10:46 8-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff  37284531 13 Sep 10:46 7-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff  10411945 13 Sep 10:46 6-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff  39365253 13 Sep 10:46 5-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff    545756 13 Sep 10:46 4-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff  41446864 13 Sep 10:46 3-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff   3441084 13 Sep 10:46 2-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff   9201179 13 Sep 10:46 16-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff  34645903 13 Sep 10:46 15-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff   9292120 13 Sep 10:46 14-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff  34901946 13 Sep 10:46 13-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff   9147148 13 Sep 10:46 12-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff  34558478 13 Sep 10:46 11-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff   9117238 13 Sep 10:46 10-metadata-1.warc.gz
  -rw-r--r--   1 pmd  staff    143775 13 Sep 10:46 1-metadata-1.warc.gz
```

## Extact the metadata from the WARC archives

To extract metadata from these files, we use the ETL Netarkivet project[^2]. You can either clone this project or just grab the nessecary Python file by executing these commands in the root of this Getting Started project:

```{r}
$ mkdir bin
$ cd bin
$ curl -O https://raw.githubusercontent.com/Kulturarvscluster/ETL_Netarkivet/master/src/extract_multiple_archives_one_output.py
```

To run this Python script you need the `warc`[^3] Python module which is best installed using `pip`.

```{r}
$ pip install --user warc
```

To ensure that the installation succeded, perform the following minimal test

```
$ python2
Python 2.7.13 (default, Sep 10 2017, 16:06:44) 
[GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.35)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import warc
>>> 
```

The `extract_multiple_archives_one_output.py` script takes as input a file with a list of ARC and WARC archives to extract metadata from and a list of metadata files to extact from these archives.

The list of files to run on must consist of a set of lines, where each line is a path to a WARC or ARC file. In this tutorial, we create this file like this

```{r}
~/Documents/src_projects/Getting Startet With Netarkivet-ETL $ find fodbold -name '*.warc.gz' | sed 's#^#../#' | tee fodbold-input
../fodbold/14-metadata-1.warc.gz
../fodbold/7-metadata-1.warc.gz
../fodbold/4-metadata-1.warc.gz
../fodbold/9-metadata-1.warc.gz
../fodbold/2-metadata-1.warc.gz
../fodbold/11-metadata-1.warc.gz
../fodbold/12-metadata-1.warc.gz
../fodbold/1-metadata-1.warc.gz
../fodbold/13-metadata-1.warc.gz
../fodbold/3-metadata-1.warc.gz
../fodbold/10-metadata-1.warc.gz
../fodbold/5-metadata-1.warc.gz
../fodbold/16-metadata-1.warc.gz
../fodbold/8-metadata-1.warc.gz
../fodbold/15-metadata-1.warc.gz
../fodbold/6-metadata-1.warc.gz
```

In this tutorial we are only insterested in the `crawl.log` metadata file which we extract thus

```
$ python2 ../bin/extract_multiple_archives_one_output.py ../fodbold-input crawl.log 2> report
WARC, 14, Found, crawl.log, ../fodbold/14-metadata-1.warc.gz, 40891783,, 
WARC, 7, Found, crawl.log, ../fodbold/7-metadata-1.warc.gz, 179075897,, 
WARC, 4, Found, crawl.log, ../fodbold/4-metadata-1.warc.gz, 2202373,, 
WARC, 9, Found, crawl.log, ../fodbold/9-metadata-1.warc.gz, 185425948,, 
WARC, 2, Found, crawl.log, ../fodbold/2-metadata-1.warc.gz, 10050264,, 
WARC, 11, Found, crawl.log, ../fodbold/11-metadata-1.warc.gz, 187760291,, 
WARC, 12, Found, crawl.log, ../fodbold/12-metadata-1.warc.gz, 40823113,, 
WARC, 1, Found, crawl.log, ../fodbold/1-metadata-1.warc.gz, 365070,, 
WARC, 13, Found, crawl.log, ../fodbold/13-metadata-1.warc.gz, 186704724,, 
WARC, 3, Found, crawl.log, ../fodbold/3-metadata-1.warc.gz, 163745586,, 
WARC, 10, Found, crawl.log, ../fodbold/10-metadata-1.warc.gz, 40358308,, 
WARC, 5, Found, crawl.log, ../fodbold/5-metadata-1.warc.gz, 206376447,, 
WARC, 16, Found, crawl.log, ../fodbold/16-metadata-1.warc.gz, 40798379,, 
WARC, 8, Found, crawl.log, ../fodbold/8-metadata-1.warc.gz, 40414046,, 
WARC, 15, Found, crawl.log, ../fodbold/15-metadata-1.warc.gz, 187673375,, 
WARC, 6, Found, crawl.log, ../fodbold/6-metadata-1.warc.gz, 38328873,, 
```

The script writes errors to standard error, which we send to the `report` file which in our case is empty. If one should want to only extract data from some of the files in `fodbold-input`, the #-sign can be used to comment out all but the files one wants to extract data from.

Just to make it easier on ourselves, we'll create a small subset of that 1.5GB and 4,952,809 file. A

```{r}
$ head -5000 data/crawl.log > data/crawl-5000.log
```

And that's it, Folks!

[^1]: https://sbforge.org/display/NAS/NetarchiveSuite

[^2]: This project is still in its early alpha state! https://github.com/Kulturarvscluster/ETL_Netarkivet

[^3]: https://warc.readthedocs.io/en/latest/
